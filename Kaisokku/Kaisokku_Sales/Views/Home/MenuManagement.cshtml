
@model Kaisokku_Common.AddDynamicMenu

@{
    /**/

    /**/

    ViewBag.Title = "MenuManagement";
}

@Html.Hidden("DeleteMenuId")
<h2>@Kaisokku_Sales.Resources.Resource.MenuManagement</h2>

@using (Html.BeginForm("MenuManagement", "Home", FormMethod.Post))
{
    @Html.TextBoxFor(model => model.MenuName)
    @Html.ValidationMessageFor(model => model.MenuName)
<button type="submit">@Kaisokku_Sales.Resources.Resource.CreateMenu</button>
}

@if (TempData["Message"] != null && TempData["Message"].ToString() != "")
{
    <div class="container">

        @if (TempData["ErrorCode"] != null && TempData["ErrorCode"].ToString() == "1")
        {
            <div class="row">
                <div class="col-md-4" style="padding-left: 0px;padding-top: 10px;">
                    <div class="alert alert-success alert-dismissible ">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <strong>@Kaisokku_Sales.Resources.Resource.Success</strong> @TempData["Message"].ToString()
                    </div>
                </div>
            </div>

        }
        else
        {
            <div class="row">
                <div class="col-md-4" style="padding-left: 0px;padding-top: 10px;">
                    <div class="alert alert-danger alert-dismissible ">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <strong>Danger!</strong> @TempData["Message"].ToString()
                    </div>
                </div>
            </div>

        }

    </div>

}



<div class="container">
    <br />
    <div style="width:90%; margin:0 auto;">
        <table id="MenuGrid" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th>@Kaisokku_Sales.Resources.Resource.MenuId</th>
                    <th>@Kaisokku_Sales.Resources.Resource.MenuName</th>
                    <th>@Kaisokku_Sales.Resources.Resource.CreatedBy</th>
                    <th>@Kaisokku_Sales.Resources.Resource.IpAddress</th>
                    <th>@Kaisokku_Sales.Resources.Resource.Edit</th>
                    <th>@Kaisokku_Sales.Resources.Resource.Delete</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
<!-- Button EditMenuModal trigger modal -->
@*<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#EditMenuModal"></button>*@

<!-- Modal EditMenuModal -->
<div class="modal fade" id="EditMenuModal" tabindex="-1" role="dialog" aria-labelledby="EditMenuModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="EditMenuModalLabel">@Kaisokku_Sales.Resources.Resource.EditMenu</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body editmenucontent">
                EditMenuModal

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">@Kaisokku_Sales.Resources.Resource.Close</button>
                <button type="button" class="btn btn-primary btnsavemenu">@Kaisokku_Sales.Resources.Resource.SaveChanges</button>
            </div>
        </div>
    </div>
</div>


<!-- Button DeleteMenuModal trigger modal -->
@*<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#DeleteMenuModal"></button>*@

<!-- Modal DeleteMenuModal -->
<div class="modal fade" id="DeleteMenuModal" tabindex="-1" role="dialog" aria-labelledby="DeleteMenuModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="DeleteMenuModalLabel">@Kaisokku_Sales.Resources.Resource.DeleteMenu</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body Deletemenucontent">
                @Kaisokku_Sales.Resources.Resource.Areyousureyouwanttodeletemenu

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">@Kaisokku_Sales.Resources.Resource.No</button>
                <button type="button" class="btn btn-primary btndeletemenu btn-danger">@Kaisokku_Sales.Resources.Resource.Yes</button>
            </div>
        </div>
    </div>
</div>

@section ScriptSection
{

    <script>
        function RefreshDataTable() {
            $('#MenuGrid').DataTable().ajax.reload(null, false);
            $("#MenuGrid").DataTable().page('first').draw('page');
            //mApp.unblock('#dltpopup .modal-content');
            //mApp.unblockPage();
        }
        $(document).ready(function () {
            
            $("#MenuGrid").DataTable({

                "processing": true, // for show progress bar
                "serverSide": false, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "pageLength": 5,

                "ajax": {
                     "url":  "@Url.Action("LoadMenuListData", "Home")",
                    "type": "POST",
                    "datatype": "json"
                },

                "columnDefs":
                    [{
                        "targets": [0],
                        "visible": false,
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [1],
                        //"visible": true,
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [2],
                        "searchable": false,
                        "orderable": true
                    },
                    {
                        "targets": [3],
                        "searchable": false,
                        "orderable": false
                    },
                    {
                        "targets": [4],
                        "searchable": false,
                        "orderable": false
                    },
                    {
                        "targets": [5],
                        "searchable": false,
                        "orderable": false
                    }
                    ],


                "columns": [
                    { "data": "MenuId", "name": "MenuId", "autoWidth": true },
                    { "data": "MenuName", "name": "MenuName", "autoWidth": true },
                    { "data": "CreatedBy", "name": "CreatedBy", "autoWidth": true },

                    { "data": "IpAddress", "name": "IpAddress", "autoWidth": true },

                    {
                        "render": function (data, type, row, meta) { return "<a class='btn btn-info' href='javascript:void(0);' onclick=EditMenu('" + row.MenuId + "');>@Kaisokku_Sales.Resources.Resource.Edit</a>"; }
                    },
                    {
                        data: null, render: function (data, type, row) {
                            return "<a href='#' class='btn btn-danger' onclick=DeleteMenuConfirmation('" + row.MenuId + "'); >@Kaisokku_Sales.Resources.Resource.Delete</a>";
                        }
                    },

                ]

            });

            $('.btnsavemenu').on('click', function () {
              
                var MenuId = $('#EditMenuId').val();
                var MenuName = $('#EditMenuName').val();
                var updatedby = $('#EdtiMenuupdatedby').val();
               
                $('#EditMenuModal').modal('hide');
                $.ajax({
                    url: '@Url.Action("SaveMenuListData", "Home")',
                    type: 'POST',
                    data: { 'MenuId': MenuId, 'MenuName': MenuName, 'updatedby': updatedby },
                    success: function (result) {
                      
                        if (result.errorcode == 0) {
                            alert('@Kaisokku_Sales.Resources.Resource.MenuUpdatedSuccessfully');
                            RefreshDataTable();
                        }
                        else {
                            alert('@Kaisokku_Sales.Resources.Resource.MenuUpdationFailed');
                        }
                    },
                    error: function (error) {
                        console.log(error);
                    }

                });
            });
            $('.btndeletemenu').on('click', function () {
                DeleteMenu($('#DeleteMenuId').val());
            });
        });

        function EditMenu(MenuId) {
            
            $.ajax({
                url: '@Url.Action("GetMenuListDataById", "Home")',
                type: 'POST',
                data: { 'MenuId': MenuId },
                success: function (result) {
                   
                    $('.editmenucontent').html(result);
                    $('#EditMenuModal').modal('show');
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

         function DeleteMenuConfirmation(MenuId) {
             $('#DeleteMenuId').val(MenuId);
             $('#DeleteMenuModal').modal('show');
        }

        function DeleteMenu(MenuId) {
            $('#DeleteMenuModal').modal('hide');
            $.ajax({
                url: '@Url.Action("DeleteMenuById", "Home")',
                type: 'POST',
                data: { 'MenuId': MenuId },
                success: function (result) {                  
                    if (result.errorcode == 0) {
                        
                        alert('@Kaisokku_Sales.Resources.Resource.MenuAddesSuccessfully');
                        RefreshDataTable();
                    }
                    else {
                        alert('@Kaisokku_Sales.Resources.Resource.MenuDeletionFailed');
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }
    </script>
}


