
@{
    ViewBag.Title = "CRMContact";
}

<h2>CRMContact</h2>

@Html.Hidden("UserCustomId")

<div class="row" style="padding-top: 10px;">
    <div class="col-md-2">
        @Html.Label("ContactName")
        @Html.Hidden("UserId")
    </div>
    <div class="col-md-3">
        @Html.TextBox("ContactName", null, new { @class = "form-control", id = "ContactName" })
    </div>
    <div class="col-md-7">
        <button type="submit" class="btn btn-primary btncreatemenu">Import Contacts</button>
    </div>
</div>
<div class="row" style="padding-top: 10px;">
    <div class="col-md-2">
        @Html.Label("CompanyName")
    </div>
    <div class="col-md-3">
        @Html.TextBox("CompanyName", null, new { @class = "form-control", id = "CompanyName" })
    </div>
</div>
<div class="row" style="padding-top: 10px;">
    <div class="col-md-2">
        @Html.Label("Email")
    </div>
    <div class="col-md-3">
        @Html.TextBox("Email", null, new { @class = "form-control", id = "Email" })
    </div>
</div>

@*<div class="row">
        <div class="col-md-2">
            @Html.Label("Customer Type")
        </div>
        <div class="col-md-4">
            @Html.DropDownList("CustomerSelection", (IEnumerable
           <SelectListItem>)TempData["CustomerSelection"])
        </div>

        @{TempData.Keep("CustomerSelection");}
    </div>*@



<div class="row checkbox">
    @*<div class="col-md-2">
            @Html.Label("Active")
        </div>
        <div class="col-md-1">
            @Html.CheckBox("IsActive", false, new { })
        </div>*@
    <div class="col-md-3" style="padding-bottom: 5px;">
        <button class="btn btn-primary" type="submit" id="btnSubmit">Submit</button>
    </div>
</div>



<div class="container">
    <br />
    <div style="width:100%; margin:0 auto;">
        <table id="CRMContentGrid" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th>UserCustomId</th>
                    <th>ContactName</th>
                    <th>CompanyName</th>
                    @*<th>IsActive</th>*@
                    @*<th>CreatedDate</th>*@
                    @*<th>CustomerType</th>*@
                    <th>Email</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
<div class="modal fade" id="CreateVideoModal" tabindex="-1" role="dialog" aria-labelledby="CreateVideoModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="CreateVideoModalLabel">Bulk Import</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body createVideocontent">
                CreateVideoModal

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary btnimport">Import</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="EditCRMModal" tabindex="-1" role="dialog" aria-labelledby="EditUserModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="EditUserModalLabel">Edit User</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body editcrmcontent">
                EditCRMModal

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary btnsavecrm">Save changes</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="DeleteCRMModal" tabindex="-1" role="dialog" aria-labelledby="DeleteUserModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="DeleteUserModalLabel">Delete CRM</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body Deleteusercontent">
                Are you sure to delete user?

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                <button type="button" class="btn btn-primary btndeletecrm btn-danger">Yes</button>
            </div>
        </div>
    </div>
</div>


@section ScriptSection
    {


    <script>
    $(document).ready(function () {
        debugger;
        $.ajax({
            url: '@Url.Action("GetCRMLastUserId", "Home")',
            type: 'GET',
            success: function (result) {
                $('#UserId').val(result);
            },
            error: function (error) {
                console.log(error);
            }
        });

    });
    </script>

    <script>
        function RefreshDataTable() {
            $('#CRMContentGrid').DataTable().ajax.reload(null, false);
            $("#CRMContentGrid").DataTable().page('first').draw('page');
        }
    </script>


    <script>
        $(document).ready(function () {
            $("#CRMContentGrid").DataTable({
                "processing": true, // for show progress bar
                "serverSide": false, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "pageLength": 5,


                "ajax": {
                    "url":  "@Url.Action("LoadCRMListData", "Home")",
                    "type": "POST",
                    "datatype": "json"
                },

                "columnDefs":
                    [{
                        "targets": [0],
                        "visible": false,
                        "searchable": false,
                        "orderable": false
                    },

                    {
                        "targets": [1],
                        "searchable": true,
                        "orderable": true
                    },

                    {
                        "targets": [2],
                        "searchable": true,
                        "orderable": true
                    },

                    {
                        "targets": [3],
                        "searchable": true,
                        "orderable": true
                    },

                    //{
                    //    "targets": [4],
                    //    "searchable": false,
                    //    "orderable": false
                    //},



                        {
                            "targets": [4],
                            "searchable": false,
                            "orderable": false
                        },
                    {
                        "targets": [5],
                        "searchable": false,
                        "orderable": false
                    }
                    ],


                "columns": [
                    { "data": "UserCustomId", "name": "UserCustomId", "autoWidth": true },
                    { "data": "ContactName", "name": "ContactName", "autoWidth": true },
                    { "data": "CompanyName", "name": "CompanyName", "autoWidth": true },


                    //{ "data": "IsActive", "name": "IsActive", "autoWidth": true },
                    //{
                    //    "data": "CreatedDate", "name": "CreatedDate", "autoWidth": true,
                    //    "type": "date ",
                    //    "render": function (value) {
                    //        if (value === null) return "";
                    //        var pattern = /Date\(([^)]+)\)/;
                    //        var results = pattern.exec(value);
                    //        var dt = new Date(parseFloat(results[1]));
                    //        var month = dt.getMonth() + 1;
                    //        //return (month.toString().length > 1 ? month : "0" + month) + "/" + dt.getDate() + "/" + dt.getFullYear()
                    //        return (dt.getFullYear() + "/" + (month.toString().length > 1 ? month : "0" + month) + "/" + dt.getDate())

                    //    }
                    //},
                    //{ "data": "CreatedDate", "name": "CreatedDate", "autoWidth": true },
                    //{ "data": "CustomerType", "name": "CustomerType", "autoWidth": true },
                    { "data": "Email", "name": "Email", "autoWidth": true },
                    {
                        "render": function (data, type, row, meta) { return "<a class='btn btn-info' href='javascript:void(0);' onclick=EditUser('" + row.UserCustomId + "');>Edit</a>"; }
                    },
                    {
                        data: null, render: function (data, type, row) {
                            return "<a href='#' class='btn btn-danger' onclick=DeleteUserConfirmation('" + row.UserCustomId + "'); >Delete</a>";
                        }
                    },

                ]

            });


        });

         $('.btnsavecrm').on('click', function () {
            //edit and save
             var UserCustomId = $('#EditCRMId').val();
             var ContactName = $('#EditContactName').val();
             var CompanyName = $('#EditCompanyName').val();
            //var IsActive = $("#Active").is(':checked')
            var Email = $('#EditEmail').val();
            //var CustomerType = $('#CustomerType option:selected').val();
            $('#EditCRMModal').modal('hide');
                $.ajax({
                    url: '@Url.Action("SaveCRMListData", "Home")',
                    type: 'POST',
                    data: { 'UserCustomId': UserCustomId, 'ContactName': ContactName, 'CompanyName': CompanyName/*, 'Active': IsActive*/, 'Email': Email},
                    success: function (result) {

                        if (result.errorcode == 0) {
                            alert('User Updated Successfully');
                            RefreshDataTable();
                        }
                        else {
                            alert('User Updation Failed.');
                        }
                    },
                    error: function (error) {
                        console.log(error);
                    }

                });
        });


        $('#btnSubmit').on('click', function () {

            var ContactName = $('#ContactName').val();
         var CompanyName = $('#CompanyName').val();
        var Email = $('#Email').val();
        //var Active = $("#IsActive").is(':checked')

          var UserId = $('#UserId').val();
        //var CustomerType = $('#CustomerSelection option:selected').val();
        var dataobj = {
            'ContactName': ContactName, 'CompanyName': CompanyName, 'UserId': UserId, /*'IsActive': Active,*/ 'Email': Email /*'CustomerType': CustomerType*/};
        $.ajax({
        url: '@Url.Action("AddCRMContentInformation", "Home")',
        type: 'POST',
        data: dataobj,
        success: function (result) {

        if (result.errorcode == 0)
        {

            $('#ContactName').val("");
            $('#CompanyName').val("");
            //$('#Email').val("");
            //$("#IsActive").prop("checked", false);
            $('#UserId').val();
            $('#Email').val("");
            RefreshDataTable();
            alert('User Saved Successfully.');
        }
        else
        {
            alert('User Save Failed.');
        }
        },
        error: function (error) {
                console.log(error);
        }

            });
        });

        $('.btnimport').on('click', function () {
                debugger;
                //if ($('#CreateVideoTitle').val() == "") {
                //    document.getElementById("demo").innerHTML = "Please enter Title";
                //}
                //else if ($('#CreateVideoDesc').val() == "") {
                //    document.getElementById("demo").innerHTML = "Please enter Description";
                //}
                //else if ($("#CreateVideoFile").get(0).files.length == 0) {
                //    document.getElementById("demo").innerHTML = "Please upload PPT File";
                //}
                //else {
                    //var VideoTitle = $('#CreateVideoTitle').val();
                    //var VideoDesc = $('#CreateVideoDesc').val();
                    //var updateVideoFile = $('#CreateVideoFile').val();
                    var updateVideoFile = $("#CreateVideoFile").get(0).files;
                    var fileData = new FormData();

                    for (var i = 0; i < updateVideoFile.length; i++) {
                        fileData.append("CreateVideoFile", updateVideoFile[i]);
                    }
                    //fileData.append('VideoTitle', VideoTitle)
                    //fileData.append('VideoDesc', VideoDesc)
                    //$('#CreateVideoModal').modal('hide');
                    $.ajax({
                        url: '@Url.Action("importbullkcontact", "Home")',
                        type: 'POST',
                        contentType: false,
                        processData: false,
                        data: fileData,
                        success: function (result) {

                            if (result.errorcode == 0) {
                                alert('Imported Successfully');
                                RefreshDataTable();
                            }
                            else {
                                alert('Import Failed.');
                            }
                        },
                        error: function (error) {
                            console.log(error);
                        }

                    });
                //}
            });
    </script>

    <script>
        function EditUser(UserCustomId) {
            debugger;
            $.ajax({
                url: '@Url.Action("GetCRMListDataById", "Home")',
                type: 'POST',
                data: { 'UserCustomId': UserCustomId },
                success: function (result) {
                    debugger;
                    $('.editcrmcontent').html(result);
                    $('#EditCRMModal').modal('show');
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }
    </script>

    <script>


        function DeleteUserConfirmation(UserCustomId) {

            $('#UserCustomId').val(UserCustomId);
            $('#DeleteCRMModal').modal('show');
        }


        $('.btndeletecrm').on('click', function () {
            DeleteCRM($('#UserCustomId').val());
        });

         $('.btncreatemenu').on('click', function () {
              //  $('.editVideocontent').html();
              //  $('#EditVideoModal').modal('show');
                debugger;
                $.ajax({
                url: '@Url.Action("CreateBulkimportList", "Home")',
                type: 'GET',
                success: function (result) {
                    debugger;
                    $('.createVideocontent').html(result);
                    $('#CreateVideoModal').modal('show');
                     },
                error: function (error) {
                    console.log(error);
                }
            });
            });


    </script>

    <script>
        function DeleteCRM(UserCustomId) {

            $('#DeleteCRMModal').modal('hide');
            $.ajax({
                url: '@Url.Action("DeleteCRMById", "Home")',
                type: 'POST',
                data: { 'UserCustomId': UserCustomId },
                success: function (result) {
                    if (result.errorcode == 0) {

                        alert('User Deleted Successfully');
                        RefreshDataTable();
                    }
                    else {
                        alert('User Deletion Failed.');
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }
    </script>
}