
@model RPA_Common.Tasks

@{
    /**/

    /**/

    ViewBag.Title = "TaskManagement";
}

@Html.Hidden("DeleteVideoId")
<h2>@RPA_Sales.Resources.Resource.TaskManagement</h2>

@*@using (Html.BeginForm("VideoManagement", "Home", FormMethod.Post))
    {*@
<button type="submit" class="btn btn-primary btncreatemenu">@RPA_Sales.Resources.Resource.CreateNewTask</button>
@*}*@

@if (TempData["Message"] != null && TempData["Message"].ToString() != "")
{
    <div class="container">

        @if (TempData["ErrorCode"] != null && TempData["ErrorCode"].ToString() == "1")
        {
            <div class="row">
                <div class="col-md-4" style="padding-left: 0px;padding-top: 10px;">
                    <div class="alert alert-success alert-dismissible ">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <strong>Success!</strong> @TempData["Message"].ToString()
                    </div>
                </div>
            </div>

        }
        else
        {
            <div class="row">
                <div class="col-md-4" style="padding-left: 0px;padding-top: 10px;">
                    <div class="alert alert-danger alert-dismissible ">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <strong>Danger!</strong> @TempData["Message"].ToString()
                    </div>
                </div>
            </div>

        }

    </div>

}

<div class="container">
    <br />
    <div style="width:90%; margin:0 auto;">
        <table id="TaskGrid" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0" cellpadding="5">
            <thead>
                <tr>
                    <th>TaskId</th>
                    <th>@RPA_Sales.Resources.Resource.Title</th>
                    <th>@RPA_Sales.Resources.Resource.Description</th>
                    <th>@RPA_Sales.Resources.Resource.UserId</th>
                    <th>@RPA_Sales.Resources.Resource.Edit</th>
                    @*<th>View</th>*@
                    <th>@RPA_Sales.Resources.Resource.Delete</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
<!-- Modal CreateMenuModal -->
<div class="modal fade" id="CreateVideoModal" tabindex="-1" role="dialog" aria-labelledby="CreateVideoModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="CreateVideoModalLabel">@RPA_Sales.Resources.Resource.CreateTask</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body createVideocontent">
                CreateVideoModal

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">@RPA_Sales.Resources.Resource.Close</button>
                <button type="button" class="btn btn-primary btnscreateavemenu">@RPA_Sales.Resources.Resource.SaveChanges</button>
            </div>
        </div>
    </div>
</div>
<!-- Button EditMenuModal trigger modal -->
@*<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#EditMenuModal"></button>*@

<!-- Modal EditMenuModal -->
<div class="modal fade" id="EditVideoModal" tabindex="-1" role="dialog" aria-labelledby="EditVideoModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="EditVideoModalLabel">@RPA_Sales.Resources.Resource.EditTask</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body editVideocontent">
                EditVideoModal

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">@RPA_Sales.Resources.Resource.Close</button>
                <button type="button" class="btn btn-primary btnsavemenu">@RPA_Sales.Resources.Resource.SaveChanges</button>
            </div>
        </div>
    </div>
</div>



<!-- Button DeleteMenuModal trigger modal -->
@*<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#DeleteMenuModal"></button>*@

<!-- Modal DeleteMenuModal -->
<div class="modal fade" id="DeleteVideoModal" tabindex="-1" role="dialog" aria-labelledby="DeleteVideoModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="DeleteVideoModalLabel">@RPA_Sales.Resources.Resource.DeleteVideo</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body DeleteVideocontent">
                @RPA_Sales.Resources.Resource.AreyousureyouwanttodeletetheTask

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">@RPA_Sales.Resources.Resource.No</button>
                <button type="button" class="btn btn-primary btndeletevideo btn-danger">@RPA_Sales.Resources.Resource.Yes</button>
            </div>
        </div>
    </div>
</div>

@section ScriptSection
{
    <script>
            function RefreshDataTable() {
                debugger;
                $('#TaskGrid').DataTable().ajax.reload(null, false);
                $("#TaskGrid").DataTable().page('first').draw('page');
            //mApp.unblock('#dltpopup .modal-content');
            //mApp.unblockPage();
        }
        $(document).ready(function () {
            debugger;
            $("#TaskGrid").DataTable({

                "processing": true, // for show progress bar
                "serverSide": false, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "pageLength": 5,

                "ajax": {
                    "url": "/Home/LoadTaskListData",
                    "type": "POST",
                    "datatype": "json"
                },

                "columnDefs":
                    [{
                        "targets": [0],
                        "visible": false,
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [1],
                        //"visible": true,
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [2],
                        "searchable": false,
                        "orderable": true
                    },
                    {
                        "targets": [3],
                        "searchable": false,
                        "orderable": false
                    },
                    {
                        "targets": [4],
                        "searchable": false,
                        "orderable": false
                    },
                    {
                        "targets": [5],
                        "searchable": false,
                        "orderable": false
                        }
                    //{
                    //        "targets": [6],
                    //        "searchable": false,
                    //        "orderable": false
                    //    }
                        //{
                        //    "targets": [7],
                        //    "searchable": false,
                        //    "orderable": false
                        //}
                        //{
                        //    "targets": [8],
                        //    "searchable": false,
                        //    "orderable": false
                        //}

                    ],


                "columns": [
                    { "data": "TaskMasterId", "name": "TaskMasterId", "autoWidth": true },
                    { "data": "TaskName", "name": "TaskName", "autoWidth": true },
                    { "data": "TaskDescription", "name": "TaskDescription", "autoWidth": true },
                   // { "data": "Filename", "name": "Filename", "autoWidth": true },

                    { "data": "userid", "name": "userid", "autoWidth": true },
                  //  { "data": "Viewcount", "name": "Viewcount", "autoWidth": true },

                    {
                        "render": function (data, type, row, meta) { return "<a class='btn btn-info' href='javascript:void(0);' onclick=EditVideo('" + row.TaskMasterId + "');>@RPA_Sales.Resources.Resource.Edit</a>"; }
                    },
                    //{
                    //    "render": function (data, type, row, meta) { return "<a class='btn btn-info' href='javascript:void(0);' onclick=ViewVideo('" + row.MediaID + "');>@RPA_Sales.Resources.Resource.View</a>"; }
                    //},
                    {
                        data: null, render: function (data, type, row) {
                            return "<a href='#' class='btn btn-danger' onclick=DeleteVideoConfirmation('" + row.TaskMasterId + "'); >@RPA_Sales.Resources.Resource.Delete</a>";
                        }
                    },

                ]

            });
            $('.btncreatemenu').on('click', function () {
              //  $('.editVideocontent').html();
              //  $('#EditVideoModal').modal('show');
                debugger;
                $.ajax({
                url: '@Url.Action("CreateTaskListData", "Home")',
                type: 'GET',
                success: function (result) {
                    debugger;
                    $('.createVideocontent').html(result);
                    $('#CreateVideoModal').modal('show');
                     },
                error: function (error) {
                    console.log(error);
                }
            });
            });

            $('.btnsavemenu').on('click', function () {
                if ($('#EditTaskId').val() == "") {
                    document.getElementById("demo").innerHTML = "Please enter ID";
                }
                else if ($('#EditTaskTitle').val() == "") {
                    document.getElementById("demo").innerHTML = "Please enter Title";
                }
                else if ($('#EditTaskDesc').val() == "") {
                    document.getElementById("demo").innerHTML = "Please enter Description";
                }
                else {
                    var TaskName = $('#EditTaskTitle').val();
                    var TaskDescription = $('#EditTaskDesc').val();
                    var Taskid = $('#EditTaskId').val();

                    $('#EditVideoModal').modal('hide');
                    $.ajax({
                        url: '@Url.Action("SaveTaskListData", "Home")',
                        type: 'POST',
                        data: { 'Taskid': Taskid, 'TaskName': TaskName, 'TaskDescription': TaskDescription, 'userid': $('#dp option:selected').val() },
                        success: function (result) {

                            if (result.errorcode == 0) {
                                alert('@RPA_Sales.Resources.Resource.TaskUpdatedSuccessfully');
                                RefreshDataTable();
                            }
                            else {
                                alert('@RPA_Sales.Resources.Resource.TaskUpdationFailed');
                            }
                        },
                        error: function (error) {
                            console.log(error);
                        }

                    });
                }
            });


            $('.btnscreateavemenu').on('click', function () {
                debugger;
                if ($('#CreateTaskTitle').val() == "" && $('#CreateTaskDes').val() == "") {
                    document.getElementById("title").innerHTML = "Please enter Title";
                    document.getElementById("des").innerHTML = "Please enter Description";

                }
                else if ($('#CreateTaskDes').val() == "" && $('#CreateTaskDes').val() != "") {
                    document.getElementById("title").innerHTML = "Please enter Title";
                    document.getElementById("des").innerHTML = "";
                }
                else if ($('#CreateTaskDes').val() != "" && $('#CreateTaskDes').val() == "") {
                    document.getElementById("title").innerHTML = "";
                    document.getElementById("des").innerHTML = "Please enter Description";
                }

                else {
                    var TaskName = $('#CreateTaskTitle').val();
                    var TaskDescription = $('#CreateTaskDesc').val();

                    $('#CreateVideoModal').modal('hide');
                    $.ajax({
                        url: '@Url.Action("SaveCreateTaskListData", "Home")',
                        type: 'POST',
                        data: { 'TaskName': TaskName, 'TaskDescription': TaskDescription, 'userid': $('#SelectUser option:selected').val() },
                        success: function (result) {

                            if (result.errorcode == 0) {
                                alert('@RPA_Sales.Resources.Resource.TaskCreatedSuccessfully');
                                RefreshDataTable();
                            }
                            else {
                                alert('@RPA_Sales.Resources.Resource.TaskCreationFailed');
                            }
                        },
                        error: function (error) {
                            console.log(error);
                        }

                    });
                }
            });


            $('.btndeletevideo').on('click', function () {
                DeleteVideo($('#DeleteVideoId').val());
            });
        });

        function EditVideo(TaskMasterId) {
            debugger;
            $.ajax({
                url: '@Url.Action("GetTaskListDataById", "Home")',
                type: 'POST',
                data: { 'TaskMasterId': TaskMasterId },
                success: function (result) {
                    debugger;
                    $('.editVideocontent').html(result);
                    $('#EditVideoModal').modal('show');
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }
       
        function DeleteVideoConfirmation(TaskMasterId) {
            debugger;
            $('#DeleteVideoId').val(TaskMasterId);
             $('#DeleteVideoModal').modal('show');
        }

        function DeleteVideo(TaskMasterId) {
            debugger;
            $('#DeleteVideoModal').modal('hide');
            $.ajax({
                url: '@Url.Action("DeleteTaskById", "Home")',
                type: 'POST',
                data: { 'TaskMasterId': TaskMasterId },
                success: function (result) {
                    if (result.errorcode == 0) {

                        alert('@RPA_Sales.Resources.Resource.TaskDeletedSuccessfully');
                        RefreshDataTable();
                    }
                    else {
                        alert('@RPA_Sales.Resources.Resource.TaskDeletionFailed');
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }
    </script>
}
