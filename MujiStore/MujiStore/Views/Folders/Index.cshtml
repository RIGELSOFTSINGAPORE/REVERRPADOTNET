
@model MujiStore.Models.tblFolder

@{
    ViewBag.Title = MujiStore.Resources.Resource.VieFoldersIndexBrowTitle;

    var FoldDTl = ViewData["FoldDTl"] as IEnumerable<MujiStore.Models.tblFolder>;
    var lan = System.Threading.Thread.CurrentThread.CurrentCulture;
    var SGdtls = ViewBag.StoreGroupDetails as IEnumerable<MujiStore.Models.tblStoreGroup>;
    ViewBag.Lan = lan.Parent.Name;
    int i = 0;
    var strname = "";
    int strlen = 0;
}
<style>
    .textbox {
        width: 450px;
    }

    #link a {
        background: none;
        cursor: pointer;
        color: blue;
        text-decoration-line: underline;
    }

    .form-horizontal .control-label {
        padding-top: 7px;
        margin-bottom: 10px;
        text-align: left;
    }

    input, select, textarea {
        max-width: 100%;
        background-color: #fff;
    }

    .form-control {
        margin-top: 5px;
    }

    ul.links {
        list-style-type: none;
    }

        ul.links li {
            display: inline-block;
            border-left: 1px solid black;
            padding-left: 10px;
            margin-left: 10px;
        }

            ul.links li:first-child {
                border-left: 0;
                padding-left: 0;
                margin-left: 0;
            }
</style>
<html lang="@ViewBag.Lan">
</html>

<script src="~/Scripts/tree.js" type="text/javascript"></script>
<link href="~/Content/treejs.css" rel='stylesheet' type='text/css'>
<script src="~/Scripts/jquery-3.3.1.min.js" type="text/javascript"></script>
<ol class="breadcrumb" id="breadcrumb">
    <li>@Html.ActionLink(MujiStore.Resources.Resource.breadcrumbVideoall, "ViewUploadDetails", "VideoFiles")</li>
    <li>
        @Html.ActionLink(@MujiStore.Resources.Resource.breadcrumbManagement, "Index", "Menus")
    </li>
    <li>@Html.ActionLink(MujiStore.Resources.Resource.breadcrumbSystemmaintenance, "InfoMenus", "Menus")</li>
    <li>
        @MujiStore.Resources.Resource.Breadcrumbfolder
    </li>
</ol>
<h2 style="color:#ec2213; background-color:#e7bebb; margin-left:-4px; margin-bottom:15px;">@MujiStore.Resources.Resource.Folderselection</h2>


<div id="link">
    <p>
        @MujiStore.Resources.Resource.Selectthefolderyouwanttochange
    </p>
    <p>
        <table id="tblFolder">
            
            <tbody style="width:100%">
                @foreach (var item in FoldDTl)
                {
                    <tr >

                        <td>
                            @Html.HiddenFor(modelItem => item.ParentID)
                           
                            <ul>
                                <li>
                                    
                                    <span>@item.STRCRTDT.Replace(" ", "\u00A0") </span>
                                        
                                        <a href="@Url.Action("Index", "Folders", new { id = item.FolderID })">

                                           
                                            <img alt="List View" src="@Url.Content("~/img/folder-close1.png")">
                                            @item.Name
                                        </a>
                                </li>
                            </ul>
                        </td>
                    
                    </tr>
                }
            </tbody>
        </table>
    </p>
    <p>
        <div id="containerMain" style = "display:none"></div>
    </p>
    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.FolderID)
        @Html.HiddenFor(model => model.DELFG)
        @Html.HiddenFor(model => model.CRTCD)
        @Html.HiddenFor(model => model.CRTDT)


        <h2 style="color:#ec2213; background-color:#e7bebb; margin-left:-4px; margin-bottom:15px;">
            @MujiStore.Resources.Resource.Folderdetails
        </h2>
        <div >

            <div class="table-responsive">
                <table class="table usertbl">
                    <tr>
                        <td style="width:20%; border:1px solid">
                            @Html.Label(MujiStore.Resources.Resource.FolderId, htmlAttributes: new { @class = "control-label " })
                        </td>
                        <td style="border: 1px solid" colspan="2">
                            @Html.EditorFor(model => model.FolderID, new { htmlAttributes = new { @class = "form-control", @style = "Width:125px;", @id = "FolderID", disabled = "disabled" } })
                            @MujiStore.Resources.Resource.registerwiththefolderIDemptyitwillbenewly
                        </td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid">
                            @Html.Label(MujiStore.Resources.Resource.FolderName, htmlAttributes: new { @class = "control-label " })
                        </td>
                        <td style="border: 1px solid;width: 50%;" colspan="2">
                            @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control", @maxlength = "250" } })
                            @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })
                        </td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid">

                            @Html.Label(MujiStore.Resources.Resource.ModtblFolderParentFolderName, htmlAttributes: new { @class = "control-label " })
                        </td>
                        <td style="border: 1px solid" colspan="2">

                            @Html.DropDownList("ParentID", null, htmlAttributes: new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.ParentID, "", new { @class = "text-danger" })
                        </td>
                    </tr>
                    <tr style="display: none;">

                        <td style="border: 1px solid">

                            @Html.Label(MujiStore.Resources.Resource.ModtblStoreStoreGroupID, htmlAttributes: new { @class = "control-label " })
                        </td>
                        <td style="border: 1px solid; width:40%">
                            @if (SGdtls != null && SGdtls.Count() > 0)
                            {
                                <div id="storegroup">

                                    @foreach (var item in SGdtls)
                                    {

                                       
                                        @Html.ActionLink(item.StoreGroupName, "DeleteStoreGroup", new { storeGroupID = item.StoreGroupID, folderID = Model.FolderID });

                                     
                                    }
                                </div>
                            }


                            @Html.DropDownList("StoreGroupID", null, htmlAttributes: new { @class = "form-control" })
                            

                        </td>
                        <td style="border: 1px solid">
                            

                            <input type="submit" id="AddSGDetails" onclick="fnAddSGDetails()" style="width: 220px; margin-left:0px;     height:35px; border: solid 1px #ccc; border-radius:5px; background-color:#7f0019;color:#fff;" value="@MujiStore.Resources.Resource.Addstoregrouptofolder" />


                            

                        </td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid">



                            <input type="submit" value=@MujiStore.Resources.Resource.Registration class="btn btn-default " style="margin-top:-6px" />

                        </td>

                        <td style="border: 1px solid" colspan="2">

                           
                            <a href=@Url.Action("Index","Folders" ,new { id = string.Empty }) style="background:#7f0019;padding-bottom: 9px;padding-top: 7px; color:white;text-decoration-line:none" class="clear">
                                @MujiStore.Resources.Resource.clear
                            </a>

                        </td>
                    </tr>

                </table>
                </div>

                <br>
                <h2 style="color:#ec2213; background-color:#e7bebb; margin-left:-4px; margin-bottom:15px;">
                    @MujiStore.Resources.Resource.note
                </h2>
                <br>
                <p hidden>
                    @MujiStore.Resources.Resource.FolderNote1
                </p>
                <p hidden>
                    @MujiStore.Resources.Resource.FolderNote2
                </p>
                <p hidden>
                    @MujiStore.Resources.Resource.FolderNote3
                </p>
                <p>
                    @MujiStore.Resources.Resource.FolderNote4
                </p>
            </div>

            }
        </div>


<script src="~/Scripts/select2/dist/js/jquery-3.0.0.js" type="text/javascript"></script>
<script src="~/Scripts/select2/dist/js/select2.js" defer type="text/javascript"></script>
<link href="~/Scripts/select2/dist/css/select2.min.css" rel='stylesheet' type='text/css'>

<script type="text/javascript">

    $(document).ready(function () {
        $(window).keydown(function (event) {
            if (event.keyCode == 13) {
                event.preventDefault();
                return false;
            }
        });
    });

    window.onload = function () {
        // Put your logic here.
        if (document.getElementById("FolderID").value != "") {
            window.scrollBy(0, 10000)
            
        }

    }
   
    function fnAddSGDetails() {
   
        var Qstr = "";
        var vDemo = 0;
 
        for (i = window.location.href.split('/').length - 1; i > 0; i--) {
            if (window.location.href.split('/')[i] === "Folders") {
                vDemo = i

                break;
            }
 
        }

        for (i = 3; i < vDemo; i++) {
            Qstr += "/" + window.location.href.split('/')[i]
        }

    
        $("form").attr("action", Qstr + "/Folders/AddStoreGroup");
       
    }
    
    var folderDtl = [];
    var fdtl = @Html.Raw(Json.Encode(FoldDTl));
    var fdlroot = new TreeNode(fdtl[0].Name);
    
    for (var i = 1; i < fdtl.length; ++i) {
       
        
        folderDtl[fdtl[i].FolderID] = new TreeNode(fdtl[i].Name);
        
    }
    
    for (var i = 1; i < fdtl.length; ++i) {
        if (fdtl[i].ParentID == "-1") {
            fdlroot.addChild(folderDtl[fdtl[i].FolderID])
        }
        else {
            folderDtl[fdtl[i].ParentID].addChild(folderDtl[fdtl[i].FolderID])
        }
       
    }
  
    var view = new TreeView(fdlroot, "#containerMain");
    
    $('.test').each(function (index, tr) {
        

        var Qstr = "";
        var vDemo = 0;
        
        for (i = window.location.href.split('/').length - 1; i > 0; i--) {
            if (window.location.href.split('/')[i].includes("Folders")) {
                vDemo = i
                
                break;
            }
            
        }

        for (i = 3; i < vDemo; i++) {
            Qstr += "/" + window.location.href.split('/')[i]
        }

        $(tr).attr("href", Qstr + "/Folders/Index/" + fdtl[index].FolderID);


        

    });
   

    $('table > tbody  > tr > td > div').each(function (index, tr) {
  
        $(tr).attr("id", "container" + index);
     
        var parid = document.getElementById("tblFolder").rows[index + 1].cells[0].childNodes[1].value;
        if (parid == "1") {
            fdlroot.setSelected(true)
        }
        else {
            folderDtl[document.getElementById("tblFolder").rows[index + 1].cells[0].childNodes[1].value].setSelected(true);
        }

      
        var view = new TreeView(fdlroot, "#container" + index);
        if (parid == "1") {
            fdlroot.setSelected(false)
        }
        else {
            folderDtl[document.getElementById("tblFolder").rows[index + 1].cells[0].childNodes[1].value].setSelected(false);
        }
        view.collapseAllNodes();
        view.reload();
        $('#container' + index).hide();
       

    });



    function getSourceID() {
        alert($("#ParentID").val())
    }

   
    $(document).ready(function () {
        $("#StoreGroupID").select2({
            templateResult: formatOptions1
        });
    });

    function formatOptions1(state) {
        $('.select2-search__field').remove();
        if (!state.id) { return state.text; }
        var strfolder = state.text;
        var root = strfolder.substr(1, (strfolder.length - strfolder.trim().length - 1))

        var $state = $(
            '<span  style="color:black">' + strfolder.trim() + '</span>'
        );
        return $state;

    }
    function split_on_first_word(str) {
        str = str.trim();  // Clean string by removing beginning and ending spaces.

        var arr = [];
        var pos = str.indexOf(' ');  // Find position of first space

        if (pos === -1) {
            // No space found
            arr.push(str);                // First word (or empty)
            arr.push('');                 // Empty (no next words)
        } else {
            // Split on first space
            arr.push(str.substr(0, pos));         // First word
            arr.push(str.substr(pos + 1).trim());  // Next words
        }
        
        return arr;
    }

    ///ParentfolderDropdown
    $(document).ready(function () {
        $("#ParentID").select2({
            templateResult: formatOptions2
        });
    });

    function formatOptions2(state) {
        $('.select2-search__field').remove();
        if (!state.id) { return state.text; }
        var strfolder = state.text;
        var root = strfolder.substr(1, (strfolder.length - strfolder.trim().length - 1))

        var $state = $(
            '<span  style="color:black">' + strfolder.trim() + '</span>'
        );
        return $state;

    }
    function split_on_first_word(str) {
        str = str.trim();  // Clean string by removing beginning and ending spaces.

        var arr = [];
        var pos = str.indexOf(' ');  // Find position of first space

        if (pos === -1) {
            // No space found
            arr.push(str);                // First word (or empty)
            arr.push('');                 // Empty (no next words)
        } else {
            // Split on first space
            arr.push(str.substr(0, pos));         // First word
            arr.push(str.substr(pos + 1).trim());  // Next words
        }
      
        return arr;
    }
</script>
